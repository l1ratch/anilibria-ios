name: Build iOS unsigned IPA

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Build unsigned IPA
      run: |
        # Параметры проекта
        PROJECT="Anilibria.xcodeproj"
        SCHEME="Anilibria"  # замените на фактическую схему из Xcode
        ARCHIVE_PATH="$PWD/build/Anilibria.xcarchive"
        EXPORT_PATH="$PWD/build"

        # Архивируем проект
        xcodebuild -project "$PROJECT" -scheme "$SCHEME" -configuration Release -archivePath "$ARCHIVE_PATH" archive

        # Экспортируем unsigned IPA
        xcodebuild -exportArchive -archivePath "$ARCHIVE_PATH" -exportPath "$EXPORT_PATH" -exportOptionsPlist ExportOptions.plist

    - name: Upload IPA artifact
      uses: actions/upload-artifact@v4
      with:
        name: unsigned-ipa
        path: build/*.ipa
